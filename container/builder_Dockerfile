FROM rust:latest
RUN apt-get update && \
    apt-get -y install ca-certificates cmake musl-tools libssl-dev openssl g++-aarch64-linux-gnu libc6-dev-arm64-cross && \
    rustup target add x86_64-unknown-linux-musl && \
    rustup target add i686-unknown-linux-gnu && \
    rustup target add x86_64-unknown-linux-gnu && \
    rustup target add aarch64-unknown-linux-gnu
WORKDIR /usr/scripts
COPY --chmod=554 scripts/build_artifacts.sh .
WORKDIR /usr/data
CMD ["/usr/scripts/build_artifacts.sh"]