FROM rust:latest
RUN apt-get update && \
    apt-get -y install ca-certificates cmake musl-tools libssl-dev openssl gcc-aarch64-linux-gnu clang llvm libc6-dev-arm64-cross gcc-mingw-w64-x86-64 && \
    rustup target add x86_64-unknown-linux-musl && \
    rustup target add x86_64-unknown-linux-gnu && \
    rustup target add aarch64-unknown-linux-musl && \
    rustup target add aarch64-unknown-linux-gnu && \
    rustup target add x86_64-pc-windows-gnu
ENV CC_aarch64_unknown_linux_musl=aarch64-linux-gnu-gcc
ENV AR_aarch64_unknown_linux_musl=aarch64-linux-gnu-gcc-ar
ENV CARGO_TARGET_AARCH64_UNKNOWN_LINUX_MUSL_RUSTFLAGS="-Clink-self-contained=yes -Clinker=rust-lld"
COPY --chmod=554 scripts/build_artifacts.sh /usr/local/bin
WORKDIR /data
USER 1000:1000
CMD ["/usr/local/bin/build_artifacts.sh"]